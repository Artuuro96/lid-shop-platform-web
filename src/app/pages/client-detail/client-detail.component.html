<div class="profileContent p-24">
  <a mat-button color="primary" [routerLink]="['/clientes']">
    <i-tabler name="arrow-left" class="icon-18 m-r-8"></i-tabler>
    Volver a clientes
  </a>

  <div *ngIf="loading" class="m-t-16">Cargando...</div>
  <div *ngIf="!loading && error" class="m-t-16 text-error">{{ error }}</div>

  <div class="profileCard m-t-16">
    <mat-card class="cardWithShadow overflow-hidden">
      <!-- Cover Image -->
      <img mat-card-image src="assets/images/backgrounds/profilebg.jpg" alt="Profile Cover" class="w-100" />

      <div class="row align-items-center">
        <div class="col-lg-4 order-1">
          <div class="d-flex align-items-center justify-content-around m-24">
            <div class="text-center">
              <i-tabler class="icon-20 m-b-4" name="shopping-cart"></i-tabler>
              <h6 class="mb-0 f-s-16 f-w-500">{{ client?.purchasesCount ?? 0 }}</h6>
              <p class="m-y-0 f-s-14">Compras</p>
            </div>
            <div class="text-center">
              <i-tabler class="icon-20 m-b-4" name="coin"></i-tabler>
              <h6 class="mb-0 f-s-16 f-w-500">{{ (client?.totalSold ?? 0) | currency:'MXN':'symbol':'1.2-2' }}</h6>
              <p class="m-y-0 f-s-14">Total Comprado</p>
            </div>
            <div class="text-center">
              <i-tabler class="icon-20 m-b-4" name="star"></i-tabler>
              <h6 class="mb-0 f-s-16 f-w-500">{{ client?.points }}</h6>
              <p class="m-y-0 f-s-14">Puntos</p>
            </div>
          </div>
        </div>
        <div class="col-lg-4 order-2">
          <div class="profile-img-container text-center m-t--48">
            <div class="profile-border-bg d-flex align-items-center justify-content-center rounded-circle m-x-auto">
              <div class="profile-border d-flex align-items-cent| er justify-content-center rounded-circle">
                <img [src]="'assets/images/profile/user-1.jpg'" class="profile-pic rounded-circle w-100 h-100 object-cover"
                  alt="user" />
              </div>
            </div>
            <div class="text-center m-t-2">
              <h4 class="f-s-18 f-w-600">{{ (client?.name) || '' }} {{ client?.lastName }}</h4>
              <p class="m-y-0">Cliente</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Navigation Tabs -->
       <div class="profileTabs m-t-16">
         <mat-tab-group [(selectedIndex)]="selectedTab" mat-stretch-tabs="false" mat-align-tabs="end">
           <mat-tab>
             <ng-template mat-tab-label>
              <tabler-icon name="user-circle" class="m-r-8 icon-20"></tabler-icon>
               Perfil
             </ng-template>
           </mat-tab>
           <mat-tab>
             <ng-template mat-tab-label>
               <tabler-icon name="shopping-cart" class="m-r-8 icon-20"></tabler-icon>
               Compras
             </ng-template>
           </mat-tab>
           <mat-tab>
             <ng-template mat-tab-label>
               <tabler-icon name="settings" class="m-r-8 icon-20"></tabler-icon>
               Configuración
             </ng-template>
           </mat-tab>
         </mat-tab-group>
       </div>

       <!-- Tab Content -->
       <div class="p-24">
         <div *ngIf="selectedTab === 0">
            <mat-card class="cardWithShadow shadow-none b-1">
              <mat-card-content>
                <div class="d-flex align-items-center gap-16 m-b-24">
                  <i-tabler name="device-mobile" class="icon-20"></i-tabler>
                  <h6 class="f-s-16 f-w-600">{{client?.cellphone || 'Sin Información'}}</h6>
                </div>
                <div class="d-flex align-items-center gap-16 m-b-24">
                  <i-tabler name="mail" class="icon-20"></i-tabler>
                  <h6 class="f-s-16 f-w-600">{{client?.email || 'Sin Información'}}</h6>
                </div>
                <div class="d-flex align-items-center gap-16">
                  <i-tabler name="map-pin" class="icon-20"></i-tabler>
                  <h6 class="f-s-16 f-w-600">{{client?.address || 'Sin Información'}}</h6>
                </div>
              </mat-card-content>
            </mat-card>
         </div>

         <div *ngIf="selectedTab === 1">
           <div class="row">
             <div class="col-12">
               <mat-card class="b-1 m-b-16">
                 <mat-card-header>
                   <mat-card-title>Historial de Compras</mat-card-title>
                 </mat-card-header>
                 
                 <mat-card-content>
                   <div *ngIf="client?.sales?.length === 0" class="f-s-14 text-muted">No hay ventas registradas aún.</div>
                   <div *ngIf="client?.sales?.length">
                     <table mat-table [dataSource]="client?.sales ?? []" class="w-100">
                        <!-- Fecha -->
                       <ng-container matColumnDef="date">
                         <th mat-header-cell *matHeaderCellDef>Fecha</th>
                         <td mat-cell *matCellDef="let row">{{ row.createdAt | date:'mediumDate' }}</td>
                       </ng-container>
                       <!-- Orden -->
                       <ng-container matColumnDef="orderId">
                         <th mat-header-cell *matHeaderCellDef>ID</th>
                         <td mat-cell *matCellDef="let row">{{ row.saleId }}</td>
                       </ng-container>
                       <!-- Total -->
                       <ng-container matColumnDef="total">
                         <th mat-header-cell *matHeaderCellDef>Total</th>
                         <td mat-cell *matCellDef="let row">{{ row.total | currency:'MXN':'symbol':'1.2-2' }}</td>
                       </ng-container>
                       <!-- Tipo -->
                       <ng-container matColumnDef="type">
                         <th mat-header-cell *matHeaderCellDef> Tipo </th>
                         <td mat-cell *matCellDef="let row">
                           <app-sale-type-chip [type]="row.type"></app-sale-type-chip>
                         </td>
                       </ng-container>
                       
                       <!-- Estado de pago -->
                       <ng-container matColumnDef="paymentStatus">
                         <th mat-header-cell *matHeaderCellDef> Estado de pago </th>
                         <td mat-cell *matCellDef="let row">
                           <app-sale-payment-status-chip [status]="row.paymentStatus"></app-sale-payment-status-chip>
                         </td>
                       </ng-container>
                       
                       <!-- Estado -->
                       <ng-container matColumnDef="status">
                         <th mat-header-cell *matHeaderCellDef> Estado </th>
                         <td mat-cell *matCellDef="let row">
                           <app-sale-status-chip [status]="row.status"></app-sale-status-chip>
                         </td>
                       </ng-container>
                       <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                       <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                     </table>
                   </div>
                 </mat-card-content>
               </mat-card>
             </div>
           </div>
         </div>
       </div>
     </mat-card>
   </div>
</div>