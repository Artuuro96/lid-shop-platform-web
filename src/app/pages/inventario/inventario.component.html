<mat-card class="cardWithShadow overflow-hidden position-relative">
  <mat-sidenav-container class="email-box">
    <mat-sidenav #mailnav [mode]="isOver() ? 'over' : 'side'" [opened]="!isOver()" class="mail-sidebar">
      <ng-scrollbar class="position-relative" style="height: 100%">
        <div class="p-16">
          <button mat-flat-button color="primary" class="w-100 btn-block" (click)="getAddProductRoute()">
            Nuevo Producto
          </button>
        </div>
        <div class="p-16">
          <button mat-flat-button color="primary" class="w-100 btn-block" (click)="getAddProductRoute()">
            Nueva Actualización
          </button>
        </div>
        <h5 class="m-0 p-t-16 p-x-32 f-s-14 f-w-600">Filtrar por Categoría</h5>
        <div class="p-16">
          <mat-form-field appearance="outline" class="w-150">
            <mat-select multiple [(ngModel)]="selectedCategories" (ngModelChange)="applyCategoryMultiSelect()">
              @for (folder of folders; track folder.name) {
                @if(folder.name.toLowerCase() !== 'todas' && folder.name.toLowerCase() !== 'all'){
                  <mat-option [value]="folder.name">{{ folder.name | titlecase }}</mat-option>
                }
              }
            </mat-select>
          </mat-form-field>
        </div>
        <h5 class="m-0 p-t-16 p-x-32 f-s-14 f-w-600 b-t-1">Ordenar Por</h5>
        <div class="p-16">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Ordenar Por</mat-label>
            <mat-select multiple [(ngModel)]="selectedSortBys" (ngModelChange)="applySortMultiSelect()">
              @for (note of notes; track note.name) {
              <mat-option [value]="note.name">{{ note.name | titlecase }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>
        <h5 class="m-0 p-t-16 p-x-32 f-s-14 f-w-600 b-t-1">Por Actualización</h5>
        <div class="p-16 pricing-section">
          <mat-form-field appearance="outline" class="w-100">
            <mat-select multiple [(ngModel)]="selectedUpdateRanges" (ngModelChange)="applyUpdateFilter()">
              @for (opt of updateOptions; track opt.value) {
              <mat-option [value]="opt.value">{{ opt.label | titlecase }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>
        <!--<h5 class="m-0 p-t-16 p-x-32 f-s-14 f-w-600 b-t-1">Por Género</h5>
        <div class="p-16 pricing-section">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Por Género</mat-label>
            <mat-select multiple [(ngModel)]="selectedGenders" (ngModelChange)="applyGenderFilter()">
              @for (g of genderOptions; track g.value) {
              <mat-option [value]="g.value">{{ g.label | titlecase }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>-->
      </ng-scrollbar>
    </mat-sidenav>
    <mat-sidenav-content>
      <div class="p-24" [class.blur-content]="isLoadingProducts">
        <div class="d-flex align-items-center justify-content-between m-b-24">
          @if(!isMobileView){
          <h6 class="f-s-20 f-w-600">Productos</h6>
          } @if(isMobileView){
          <button mat-mini-fab class="bg-primary text-white" aria-label="Example icon button with a delete icon"
            (click)="mailnav.toggle()">
            <i-tabler class="icon-18 d-flex" name="menu"></i-tabler>
          </button>
          }

          <div class="flex-grow-1 d-flex justify-content-end">
            <mat-form-field class="hide-hint" appearance="outline" [ngClass]="{
                'w-30': !isMobileView,
                searchBar: isMobileView
              }">
              <mat-icon matPrefix>search</mat-icon>
              <input matInput placeholder="Buscar Producto" [(ngModel)]="searchText" (ngModelChange)="filterCards()" />
              @if(searchText){
              <button matSuffix mat-icon-button aria-label="Clear" (click)="getProductList()">
                <mat-icon>close</mat-icon>
              </button>
              }
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          @for(productcard of filteredCards; track productcard.name) {
          <div class="col-sm-6 col-lg-4 p-x-12">
            <mat-card class="cardWithShadow productcard overflow-hidden b-1 cursor-pointer"
              (click)="getviewDetails(productcard)">
                <div class="img-wrapper position-relative">
                  @if(productcard.url){
                    <img [src]="productcard.url" alt="imgSrc" class="w-100" mat-card-image (error)="productcard.url=''" />
                  } @else {
                    <div class="no-image-text d-flex align-items-center justify-content-center w-100" style="height: 160px;">
                      Sin Imagen Disponible
                    </div>
                  }
                  <div class="d-flex align-items-center icon-container">
                    <button mat-mini-fab class="cart-btn-overlay bg-error text-white" matTooltip="Delete" (click)="
                        openDialog(productcard._id); $event.stopPropagation(); $event.preventDefault()
                      ">
                      <i-tabler name="trash" class="icon-16 d-flex"></i-tabler>
                    </button>
                    <button mat-mini-fab class="cart-btn-overlay bg-primary text-white" matTooltip="Edit"
                      (click)="getEditedProduct(productcard); $event.stopPropagation(); $event.preventDefault()">
                      <i-tabler name="pencil" class="icon-16 d-flex"></i-tabler>
                    </button>
                  </div>
                </div>

              <mat-card-content class="p-b-24 p-t-12 position-relative">
                <mat-card-title class="mat-headline-2 f-s-16 m-b-4 text-ellipsis text-nowrap">
                  {{ productcard.name }}
                </mat-card-title>
                <h6 class="f-s-16 f-w-600">{{ productcard.code }}</h6>
                <div class="d-flex align-items-center justify-content-between">
                  <div class="d-flex align-items-center">
                    <h6 class="f-s-16 f-w-600">$ {{ productcard.lidShopPrice }}</h6>
                    <!--<span class="f-s-14 m-l-8">$ {{ productcard.lidShopPrice }}</span>-->
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
          }
        </div>
        <div class="d-flex justify-content-center gap-8 m-t-16">
          @for (p of getDisplayPages(); track p) {
            @if (isNumber(p)) {
              @if (pageDisplay === p) {
                <button mat-flat-button color="primary" aria-current="page">
                  {{ p }}
                </button>
              } @else {
                <button mat-stroked-button (click)="onPageClick(p)">
                  {{ p }}
                </button>
              }
            } @else {
              <button mat-stroked-button disabled tabindex="-1" aria-hidden="true">
                {{ p }}
              </button>
            }
          }
        </div>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>
</mat-card>
<app-loading-overlay></app-loading-overlay>
